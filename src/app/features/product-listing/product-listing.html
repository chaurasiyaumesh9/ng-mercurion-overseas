<div class="container mx-auto px-4 py-8">

    <!-- Heading -->
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-gray-800">
            @switch (true) {
            @case (!!search()) {
            Search results for "{{ search() }}"
            }
            @case (!!subCategoryName()) {
            {{ subCategoryName() }}
            }
            @case (!!categoryName()) {
            {{ categoryName() }}
            }
            @default {
            All Products
            }
            }
        </h1>

        <!-- Breadcrumb -->
        @if (categoryName()) {
        <nav class="text-sm text-gray-600 mt-2">
            <a href="/" class="hover:text-blue-600">Home</a>
            <span class="mx-2">/</span>
            <a [href]="'/' + store.categorySlug()" class="hover:text-blue-600">
                {{ categoryName() }}
            </a>
            @if (subCategoryName()) {
            <span class="mx-2">/</span>
            <span class="font-semibold">{{ subCategoryName() }}</span>
            }
        </nav>
        }
    </div>

    <!-- Loading -->
    @if (loading()) {
    <div class="text-center py-20 text-gray-500">
        Loading products...
    </div>
    }

    <!-- Empty -->
    @if (!loading() && products().length === 0) {
    <div class="text-center py-20 text-gray-500">
        No products found.
    </div>
    }

    <!-- Grid -->
    @defer (on viewport) {
    @if (!loading() && products().length > 0) {
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">

        @for (product of products(); track product.id) {
        <div class="border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition">

            <img [src]="product.image" [alt]="product.name" class="w-full h-48 object-cover">

            <div class="p-4 flex flex-col gap-2">
                <h3 class="font-semibold text-gray-800">
                    {{ product.name }}
                </h3>

                <p class="text-sm text-gray-500 line-clamp-2">
                    {{ product.description }}
                </p>

                <div class="flex items-center gap-2">
                    <span class="text-lg font-bold text-gray-900">
                        ${{ product.price }}
                    </span>

                    @if (product.originalPrice) {
                    <span class="text-sm line-through text-gray-400">
                        ${{ product.originalPrice }}
                    </span>
                    }
                </div>

                <div class="text-sm text-yellow-700 flex items-center gap-2">
                    <app-icon name="star" class="w-5 h-5 text-yellow-700"></app-icon> <span>{{ product.rating }}</span>
                </div>

                <!-- Show category breadcrumb on product card -->
                <div class="text-xs text-gray-400">
                    {{ product.category.name }} / {{ product.subCategory.name }}
                </div>

                <button class="mt-2 bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">
                    View product
                </button>
            </div>
        </div>
        }
    </div>
    }
    } @placeholder {
    <div class="text-center py-20 text-gray-400">
        Preparing product grid...
    </div>
    }

</div>