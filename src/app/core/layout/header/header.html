<header class="w-full bg-white sticky top-0 z-40">
  <!-- ================= TOP STRIP ================= -->
  <div class="w-full bg-gray-900 text-white py-2">
    <div class="container mx-auto px-4 text-center text-sm">Free Shipping on Orders Over $100</div>
  </div>

  <!-- ================= MAIN HEADER ================= -->
  <div class="w-full md:container md:mx-auto md:px-4">
    <!-- HEADER ROW -->
    <div class="flex items-center justify-between px-4 py-3">
      <!-- LOGO -->
      <a routerLink="/" class="flex flex-col">
        <span class="text-lg font-bold text-gray-900"> Mercurion Overseas </span>
        <span class="text-xs text-gray-600 italic"> Connecting Markets Worldwide </span>
      </a>

      <!-- ================= DESKTOP SEARCH ================= -->
      <form (submit)="handleSearch($event)" class="hidden md:flex flex-1 max-w-md mx-8">
        <div class="relative w-full">
          <input
            type="text"
            placeholder="Search products..."
            [value]="searchQuery()"
            (input)="searchQuery.set($any($event.target).value)"
            class="w-full px-4 py-2 border rounded-l-md"
          />

          <button
            type="submit"
            class="absolute right-0 top-0 h-full px-4 bg-blue-600 text-white rounded-r-md flex items-center justify-center"
          >
            <app-icon name="search" class="w-5 h-5"></app-icon>
          </button>
        </div>
      </form>

      <!-- ================= DESKTOP ACTIONS ================= -->
      <div class="hidden md:flex items-center gap-4">
        <a class="text-gray-900 font-medium">Sign In</a>
        <a class="text-gray-900 font-medium">Create Account</a>

        <a routerLink="/cart" class="relative">
          <app-icon name="shopping-bag" class="w-6 h-6 text-gray-700"></app-icon>

          @if (cartStore.cartCount() > 0) {
            <span
              class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full px-2 py-0.5"
            >
              {{ cartStore.cartCount() }}
            </span>
          }
        </a>
      </div>

      <!-- ================= MOBILE ACTIONS ================= -->
      <div class="flex items-center gap-4 md:hidden">
        <!-- CART -->
        <a routerLink="/cart" class="relative">
          <app-icon name="shopping-bag" class="w-6 h-6 text-gray-800"></app-icon>

          @if (cartStore.cartCount() > 0) {
            <span
              class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full px-2 py-0.5"
            >
              {{ cartStore.cartCount() }}
            </span>
          }
        </a>

        <!-- MENU -->
        <button class="text-2xl" (click)="mobileMenuOpen.set(true)">
          <svg
            class="w-6 h-6 text-gray-500 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M18 6H6m12 4H6m12 4H6m12 4H6"
            />
          </svg>
        </button>
      </div>
    </div>

    <!-- ================= MOBILE FULL WIDTH SEARCH ================= -->
    <div class="md:hidden px-4 pb-3">
      <form (submit)="handleSearch($event)">
        <div class="relative">
          <input
            type="text"
            placeholder="Search products..."
            [value]="searchQuery()"
            (input)="searchQuery.set($any($event.target).value)"
            class="w-full px-4 py-3 border rounded-lg shadow-sm"
          />

          <button
            type="submit"
            class="absolute right-0 top-0 h-full px-4 bg-blue-600 text-white rounded-r-md flex items-center justify-center"
          >
            <app-icon name="search" class="w-5 h-5"></app-icon>
          </button>
        </div>
      </form>
    </div>

    <!-- ================= DESKTOP NAV ================= -->
    @defer (on idle) {
      <nav class="hidden md:block border-t border-b">
        <div class="container mx-auto px-4">
          <ul class="flex items-center gap-8 py-3">
            <li>
              <a routerLink="/" class="text-gray-700 hover:text-blue-600"> Home </a>
            </li>

            @for (category of categories(); track category.id) {
              <li class="relative group">
                <a [routerLink]="['/', category.slug]" class="text-gray-700 hover:text-blue-600">
                  {{ category.name }}
                </a>

                <div
                  class="absolute left-0 mt-2 w-64 bg-white rounded-md shadow-lg py-2 invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all"
                >
                  @for (sub of category.subCategories; track sub.id) {
                    <a
                      [routerLink]="['/', category.slug, sub.slug]"
                      class="block px-4 py-2 text-sm hover:bg-gray-100"
                    >
                      {{ sub.name }}
                    </a>
                  }
                </div>
              </li>
            }
          </ul>
        </div>
      </nav>
    }
  </div>
</header>

<!-- ================= MOBILE NAV DRAWER ================= -->

@if (mobileMenuOpen()) {
  <div class="fixed inset-0 z-50 md:hidden">
    <!-- BACKDROP -->
    <div class="absolute inset-0 bg-black/40" (click)="mobileMenuOpen.set(false)"></div>

    <!-- DRAWER -->
    <div
      class="absolute inset-y-0 left-0 w-full max-w-md bg-white shadow-xl flex flex-col pb-[env(safe-area-inset-bottom)]"
    >
      <!-- CLOSE -->
      <div class="flex justify-end p-4 border-b">
        <button class="text-2xl" (click)="mobileMenuOpen.set(false)">
          <svg
            class="w-6 h-6 text-gray-500 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18 17.94 6M18 18 6.06 6"
            />
          </svg>
        </button>
      </div>

      <!-- NAV CONTENT -->
      <div class="flex-1 overflow-y-auto px-4 py-6 space-y-6">
        <a routerLink="/" (click)="closeMobile()" class="block text-lg font-medium"> Home </a>

        @for (category of categories(); track category.id) {
          <div class="space-y-2">
            <a
              [routerLink]="['/', category.slug]"
              (click)="closeMobile()"
              class="block text-base font-semibold py-1"
            >
              {{ category.name }}
            </a>

            <div class="ml-3 space-y-1">
              @for (sub of category.subCategories; track sub.id) {
                <a
                  [routerLink]="['/', category.slug, sub.slug]"
                  (click)="closeMobile()"
                  class="block text-sm text-gray-600 py-1"
                >
                  {{ sub.name }}
                </a>
              }
            </div>
          </div>
        }
      </div>
    </div>
  </div>
}
