@if (product) {
  @defer (on viewport) {
    <div class="group relative">
      <!-- Image Container -->
      <div class="aspect-square w-full rounded-md bg-gray-100 overflow-hidden relative">
        <img
          [src]="product.image"
          [alt]="product.name"
          appImageFallback
          class="w-full h-full object-cover group-hover:opacity-75 transition-opacity"
        />
        <!-- Image Error Badge -->
        <!-- @if (imageFailedToLoad()) {
          <div class="absolute inset-0 flex items-center justify-center bg-gray-200 bg-opacity-75">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10 text-gray-400">
              <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0z" />
            </svg>
          </div>
        } -->
      </div>

      <!-- Product Info -->
      <div class="mt-4 flex justify-between">
        <div class="flex-1">
          <h3 class="text-sm text-gray-700 font-medium">
            <a [routerLink]="['/', product.sku]" class="hover:text-blue-600">
              <span aria-hidden="true" class="absolute inset-0"></span>
              {{ product.name }}
            </a>
          </h3>
          <p class="mt-1 text-xs text-gray-500 line-clamp-2">{{ product.description }}</p>
        </div>
      </div>

      <!-- Price & Stock -->
      <div class="mt-2 flex items-center justify-between">
        <p class="text-sm font-semibold text-gray-900">${{ product.price | number: '1.2-2' }}</p>
        @if (product.inStock) {
          <span class="inline-flex items-center rounded-full bg-green-50 px-2 py-1 text-xs font-medium text-green-700">In Stock</span>
        } @else {
          <span class="inline-flex items-center rounded-full bg-red-50 px-2 py-1 text-xs font-medium text-red-700">Out of Stock</span>
        }
      </div>
    </div>
  } @placeholder {
    <div class="aspect-square w-full rounded-md bg-gray-200 animate-pulse"></div>
  }
}
